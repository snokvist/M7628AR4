// mt7628an-m7628ar4.dts

#include "mt7628an.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>

/ {
	compatible = "custom,m7628ar4", "mediatek,mt7628an-soc";
	model = "Custom M7628AR4 (MT7628AN + MT7663E)";

	aliases { label-mac-device = &ethernet; };
	chosen {bootargs = "console=ttyS1,57600 rootfstype=squashfs,jffs2";};

	keys {
		compatible = "gpio-keys";

		wds {
			label = "wds";
			linux,code = <KEY_RFKILL>;
			linux,input-type = <EV_SW>;
			gpios = <&gpio 11 GPIO_ACTIVE_LOW>;
		};
	};
};

&spi0 {
	status = "okay";
	flash@0 {
		compatible = "jedec,spi-nor";
		reg = <0>;
		spi-max-frequency = <50000000>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@0 { label = "Bootloader"; reg = <0x000000 0x030000>; read-only; };
			partition@30000 { label = "Config";     reg = <0x030000 0x010000>; read-only; };

			factory: partition@40000 {
				label = "Factory";
				reg = <0x040000 0x010000>;
				read-only;

				/* NVMEM provider for EEPROM + MAC cells */
				compatible = "nvmem-cells";
				#address-cells = <1>;
				#size-cells = <1>;

				eeprom_7663: eeprom@8000 { reg = <0x8000 0x1000>; };   /* MT7663 EEPROM blob */
				macaddr_factory_8004: macaddr@8004 { reg = <0x8004 0x6>; }; /* 5 GHz MAC */
			};

			firmware: partition@50000 { label = "firmware"; reg = <0x050000 0xFB0000>; };
		};
	};
};

/* Internal FE MAC */
&ethernet { status = "okay"; mtd-mac-address = <&factory 0x28>; };

/* 2.4 GHz wmac (OK already) */
&wmac { status = "okay"; mediatek,mtd-eeprom = <&factory 0x0>; };

/* PCIe root + MT7663E 5 GHz */
&pcie { status = "okay"; };

&pcie0 {
	status = "okay";

	wifi@0,0 {
		compatible = "mediatek,mt7615e";
		reg = <0x0000 0 0 0 0>;

		/* calibration blob */
		mediatek,mtd-eeprom = <&factory 0x8000>;

		/* MAC via nvmem (donâ€™t use mtd-mac-address here) */
		nvmem-cells = <&macaddr_factory_8004>;
		nvmem-cell-names = "mac-address";

		/* Often required on 7663 to get sane power tables */
		mediatek,eeprom-merge-otp;

		/* (Optional) keep 5 GHz only here */
		ieee80211-freq-limit = <5000000 6000000>;
	};
};
